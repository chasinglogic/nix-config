#!/bin/bash

while getopts ':lv' flag; do
  case "$flag" in
    l) limit=1;;
    v) verbose=1;;
    \?) exit 42;;
  esac
done

shift $((OPTIND - 1))

search=$1
shift;

if [[ -n $search ]]; then
  pods=$(kubectl get pods --all-namespaces)
  header=$(echo "$pods" | head -n1)
  body=$(echo "$pods" | grep -v NAME | grep $search)
  if [[ -n $verbose ]]; then
    echo "$header"
  else
    body=$(echo "$body" | awk '{ print $2 }')
  fi

  if [[ -n $limit ]]; then
    echo $(echo "$body" | head -n1)
  else
    echo "$body"
  fi
else
    kubectl get pods --all-namespaces | grep -v NAME | fzf | awk '{ print $2 }'
fi
