#!/usr/bin/env bash

set -eou pipefail

ARGS="$@"
if [[ $ARGS != *"--base"* ]]; then
    ARGS="$ARGS --base master"
fi

if [[ $(pwd) == *"/Work/"*"Service"* || $(pwd) == *"/Work/RoadRunner"* || $(pwd) == *"/Work/MPBX"* || $(pwd) == *"/Work/common-be-scripts"* ]]; then
    ARGS="$ARGS --reviewer mpb-com/python";
elif [[ $(pwd) == *"/Work/Toucan"* || $(pwd) == *"/Work/Flamingo"* ]]; then
    ARGS="$ARGS --reviewer mpb-com/javascript"
elif [[ $(pwd) == *"/Work/WebdriverTests"* ]]; then
    ARGS="$ARGS --reviewer mpb-com/qa"
elif [[ $(pwd) == *"/Work/API-Docs"* ]]; then
    ARGS="$ARGS --reviewer mpb-com/qa --reviewer mpb-com/python --reviewer mpb-com/javascript"
elif [[ $(pwd) == *"/Work/k8s-letsencrypt"* || $(pwd) == *"/Work/environments"* || $(pwd) == *"/Work/KubernetesConfig"* ]]; then
    ARGS="$ARGS --reviewer mpb-com/operations"
elif [[ $(pwd) != *"/Work/"* ]]; then
    echo "Not a work repository, no reviewers required."
else
    echo "Failed to detect reviewers: $(pwd)"
    exit 1
fi

URL=$(gh pr create --fill --assignee chasinglogic $ARGS)
if [[ $(uname) == "Darwin" ]]; then
    open $URL
else
    xdg-open $URL
fi
